<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å•†ä¸šå¤§äº¨ V8.8ï¼šDebugä¿®å¤ç‰ˆ</title>
    <style>
        :root { --bg: #0f1115; --panel: #161b22; --border: #30363d; --primary: #58a6ff; --green: #2ea043; --red: #da3633; --gold: #e3b341; --text: #c9d1d9; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background-color: var(--bg); color: var(--text); font-family: -apple-system, sans-serif; padding: 10px; max-width: 550px; margin: 0 auto; line-height: 1.4; padding-bottom: 80px; }
        
        .header { background: var(--panel); padding: 15px; border-radius: 12px; border: 1px solid var(--border); margin-bottom: 15px; }
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 13px; }
        .stat-item { background: rgba(255,255,255,0.03); padding: 8px; border-radius: 6px; text-align: center; }
        .money-val { color: var(--gold); font-weight: bold; }
        .hp-val { color: var(--red); font-weight: bold; }
        .progress-bar { width: 100%; height: 4px; background: #333; margin-top: 4px; border-radius: 2px; }
        .progress-fill { height: 100%; background: var(--green); width: 100%; transition: width 0.3s; }

        .panel { background: var(--panel); padding: 12px; border-radius: 12px; border: 1px solid var(--border); margin-bottom: 15px; }
        .list-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #333; }
        
        button { background: #21262d; border: 1px solid var(--border); color: #fff; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-weight: bold; }
        button:active { transform: scale(0.96); }
        .btn-primary { background: #1f6feb; border-color: #1f6feb; }
        .btn-danger { background: var(--red); border-color: var(--red); }
        .btn-success { background: var(--green); border-color: var(--green); }
        .btn-gold { background: var(--gold); color: #000; border-color: var(--gold); }
        .btn-sm { padding: 4px 8px; font-size: 12px; }
        .btn-block { width: 100%; padding: 12px; margin-bottom: 5px; }

        .modal-mask { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 999; align-items: center; justify-content: center; }
        .modal-body { background: #1c2128; width: 90%; max-width: 400px; max-height: 80vh; overflow-y: auto; border-radius: 12px; border: 1px solid #444; padding: 20px; }
        .modal-title { font-size: 18px; font-weight: bold; margin-bottom: 15px; border-bottom: 1px solid #333; padding-bottom: 10px; color: var(--primary); }
        .modal-input { width: 100%; padding: 10px; background: #000; border: 1px solid #333; color: #fff; margin: 10px 0; }

        .log-box { height: 120px; overflow-y: auto; font-size: 11px; color: #888; background: #000; border: 1px solid #333; padding: 10px; margin-top: 10px; font-family: monospace; }
        .log-err { color: #ff5252; border-bottom: 1px dashed #ff5252; }
    </style>
</head>
<body>

<div id="gameModal" class="modal-mask">
    <div class="modal-body">
        <div id="mTitle" class="modal-title">æ ‡é¢˜</div>
        <div id="mContent">å†…å®¹</div>
        <div id="mFooter" style="margin-top:20px; text-align:right;">
            <button onclick="closeModal()">å…³é—­</button>
        </div>
    </div>
</div>

<div class="header">
    <div style="text-align:center; font-size:18px; font-weight:bold; color:var(--primary); margin-bottom:10px;" id="uiCompany">Loading...</div>
    <div class="stat-grid">
        <div class="stat-item">èµ„äº§ <div class="money-val" id="uiMoney">Â¥0</div></div>
        <div class="stat-item">ç”Ÿå‘½ <div class="hp-val" id="uiHp">50</div><div class="progress-bar"><div class="progress-fill" id="uiHpBar"></div></div></div>
        <div class="stat-item">ä½ç½® <div id="uiLoc">--</div></div>
        <div class="stat-item">å·²åƒ <div id="uiMeal" style="color:var(--primary)">0/3</div></div>
    </div>
    <div style="display:flex; justify-content:space-between; margin-top:10px; font-size:12px; color:#666;">
        <span id="uiRank">--</span>
        <span id="uiCap">ğŸ’ 0/0</span>
    </div>
</div>

<div style="display:grid; grid-template-columns: repeat(5, 1fr); gap:5px; margin-bottom:10px;">
    <button onclick="openBankUI()">ğŸ¦</button>
    <button onclick="openStockUI()">ğŸ“ˆ</button>
    <button onclick="openHouseUI()" style="color:var(--gold)">ğŸ </button>
    <button onclick="openLottoUI()">ğŸ°</button>
    <button onclick="openBlackUI()" class="btn-danger" style="background:#300">ğŸ’€</button>
</div>

<div class="panel">
    <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
        <b>ğŸŒ å¸‚åœº</b>
        <div>
            <button class="btn-sm" onclick="expandCap()">â• æ‰©å®¹</button>
            <button class="btn-sm btn-primary" onclick="openRestUI()">ğŸ›Œ ä¼‘æ¯/åƒé¥­</button>
        </div>
    </div>
    <div id="marketList"></div>
</div>

<div class="panel">
    <b>âœˆï¸ ç§»åŠ¨</b>
    <div id="cityList"></div>
</div>

<div class="panel">
    <button class="btn-sm" onclick="saveGame()">ä¿å­˜</button>
    <button class="btn-sm btn-danger" onclick="hardReset()">â˜ ï¸ å¼ºåˆ¶é‡ç½® (ä¿®å¤BUG)</button>
    <div class="log-box" id="gameLog"></div>
</div>

<script>
// === 1. å®‰å…¨é…ç½® ===
const CONFIG = {
    RANKS: [
        { n: "æ‘Šè´©", cost: 0, limit: 100 }, { n: "å°å–éƒ¨", cost: 3000, limit: 3000 },
        { n: "ä¾¿åˆ©åº—", cost: 10000, limit: 8000 }, { n: "è¶…å¸‚", cost: 30000, limit: 25000 },
        { n: "è´¸æ˜“å…¬å¸", cost: 80000, limit: 60000 }, { n: "è·¨å›½é›†å›¢", cost: 200000, limit: 150000 },
        { n: "å•†ä¸šå¸å›½", cost: 5000000, limit: 5000000 }, { n: "ä¸–ç•Œé¦–å¯Œ", cost: 100000000, limit: 999999999 }
    ],
    CITIES: [
        { n: "æ‘å£", dist: 0, foreign: false }, { n: "å¿åŸ", dist: 20, foreign: false },
        { n: "çœä¼š", dist: 300, foreign: false }, { n: "æ·±åœ³", dist: 1200, foreign: false },
        { n: "æ¾³é—¨", dist: 1200, foreign: false, casino: true },
        { n: "é¦–å°”", dist: 2000, foreign: true }, { n: "ä¸œäº¬", dist: 3000, foreign: true },
        { n: "è¿ªæ‹œ", dist: 6000, foreign: true }, { n: "æ‹‰æ–¯ç»´åŠ æ–¯", dist: 11000, foreign: true, casino: true },
        { n: "çº½çº¦", dist: 12000, foreign: true }
    ],
    GOODS: [
        { n: "åºŸæŠ¥çº¸", b: 1, v: 0.1, r: 0, s: 2000 }, { n: "çŸ¿æ³‰æ°´", b: 2, v: 0.1, r: 0, s: 1000 },
        { n: "ç«è…¿è‚ ", b: 5, v: 0.2, r: 0, s: 800 }, { n: "æ‰‹ç¯", b: 150, v: 0.2, r: 1, s: 200 },
        { n: "Switch", b: 2000, v: 0.3, r: 2, s: 50 }, { n: "èŒ…å°", b: 3000, v: 0.5, r: 3, s: 30 },
        { n: "åŠ³åŠ›å£«", b: 90000, v: 0.3, r: 5, s: 5 }, { n: "AIèŠ¯ç‰‡", b: 250000, v: 0.7, r: 6, s: 2 }
    ],
    STOCKS: [
        { n: "è‹±ä¼Ÿè¾¾", b: 10000 }, { n: "èŒ…å°", b: 18000 }, { n: "ç‰¹æ–¯æ‹‰", b: 6000 }
    ],
    ESTATES: [
        { id: 1, n: "è€å®¶åœŸæˆ¿", cost: 5000, rent: 50 }, { id: 2, n: "å¿åŸå…¬å¯“", cost: 50000, rent: 300 },
        { id: 3, n: "çœä¼šå­¦åŒºæˆ¿", cost: 800000, rent: 2000 }, { id: 4, n: "æ·±åœ³è±ªå®…", cost: 5000000, rent: 12000 }
    ]
};

let p = {
    name: "ATRI", money: 1000, hp: 50, day: 1,
    city: 0, home: 0, rank: 0, cap: 50,
    inv: {}, market: {}, stock: { open: false, port: {}, mkt: [] },
    bank: { dep: 0, loan: 0, due: 0 }, estate: {},
    mealCount: 0, hasEaten: false, sales: 0,
    black: { warn: false, mkt: {} }
};

// === å¯åŠ¨ ===
window.onload = function() {
    try {
        let saved = localStorage.getItem("tycoon_v88");
        if (saved) {
            let data = JSON.parse(saved);
            // æ•°æ®æ¸…æ´—ä¸åˆå¹¶
            p = { ...p, ...data };
            
            // å…³é”®ä¿®å¤ï¼šé˜²æ­¢åŸå¸‚/ç­‰çº§è¶Šç•Œ
            if (p.city >= CONFIG.CITIES.length || p.city < 0) { logErr("åŸå¸‚æ•°æ®å¼‚å¸¸ï¼Œå·²é‡ç½®å›è€å®¶"); p.city = 0; }
            if (p.rank >= CONFIG.RANKS.length) p.rank = 0;
            
            // å…³é”®ä¿®å¤ï¼šè‚¡ç¥¨æ•°æ®ç»“æ„
            if (!p.stock.mkt || p.stock.mkt.length === 0) initStocks();
        } else {
            initStocks();
            refreshMarket(true);
        }
        render();
        log("æ¸¸æˆåŠ è½½æˆåŠŸ V8.8");
    } catch (e) {
        logErr("å­˜æ¡£æŸåï¼Œæ­£åœ¨é‡ç½®: " + e.message);
        hardReset();
    }
};

function initStocks() {
    p.stock.mkt = CONFIG.STOCKS.map(s => ({ n: s.n, p: s.b, chg: 0 }));
}

// === æ ¸å¿ƒé€»è¾‘ ===
function refreshMarket(init) {
    // å•†å“
    let nm = {};
    CONFIG.GOODS.forEach(g => {
        let pr = Math.floor(g.b * (1 + (Math.random()-0.5)*2*g.v));
        nm[g.n] = { p: Math.max(1, pr), s: Math.floor(g.s * (0.5+Math.random())) };
    });
    p.market = nm;
    
    // è‚¡ç¥¨
    p.stock.mkt.forEach(s => {
        let old = s.p;
        let chg = (Math.random()-0.5) * 0.1;
        s.p = Math.floor(s.p * (1+chg));
        s.chg = (chg*100).toFixed(2);
    });
}

function nextDay() {
    // 1. è´Ÿå€ºæ£€æŸ¥ (V8.8 ä¸¥æ ¼æ¨¡å¼)
    if (p.money < 0) {
        alert("ğŸ‘® èµ„ä¸æŠµå€ºï¼\nä½ æœªèƒ½åœ¨å½“å¤©è¿˜æ¸…å€ºåŠ¡(éœ¸ç‹é¤/è´·æ¬¾)ï¼Œè¢«æ•å…¥ç‹±ï¼\n\n=== æ¸¸æˆç»“æŸ ===");
        hardReset();
        return false;
    }

    // 2. é¥¥é¥¿æ£€æŸ¥
    if (!p.hasEaten) {
        p.hp -= 10;
        logErr("âš ï¸ æ˜¨å¤©æ²¡åƒé¥­ï¼Œç”Ÿå‘½ -10");
        if (p.hp <= 0) {
            let cost = Math.floor(p.money * 0.75);
            p.money -= cost; p.hp = 20;
            alert(`ğŸ¥ é¥¿æ™•æŠ¢æ•‘ï¼\næ‰£é™¤75%èµ„äº§(Â¥${cost})ä½œä¸ºåŒ»è¯è´¹ã€‚`);
            render(); saveGame();
            return false;
        }
    }

    p.day++;
    p.mealCount = 0;
    p.hasEaten = false;
    
    // ç§Ÿé‡‘
    let rent = 0;
    for(let k in p.estate) { 
        let e = CONFIG.ESTATES.find(x=>x.id==k);
        if(e) rent += e.rent;
    }
    if(rent>0) { p.money+=rent; log("æ”¶ç§Ÿ +"+rent); }

    refreshMarket();
    if (p.city === p.home) p.sales = 0;
    
    log("ğŸ“… è¿›å…¥ç¬¬ " + p.day + " å¤©");
    render(); saveGame();
    return true;
}

// === åƒé¥­é€»è¾‘ (V8.8 ä¿®å¤ç‰ˆ) ===
function openRestUI() {
    let nextTxt = p.hasEaten ? "ğŸ“… ä¸‹ä¸€å¤© (å·²åƒ)" : "ğŸ“… ä¸‹ä¸€å¤© (æœªåƒ -10HP)";
    let nextCls = p.hasEaten ? "btn-success" : "btn-danger";
    
    showModal("ğŸ›Œ ä¼‘æ¯è¿›é£Ÿ", `
        <div style="text-align:center; margin-bottom:10px; color:#888">ä»Šæ—¥å·²åƒ: ${p.mealCount}/3</div>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
            <button onclick="doEat(1)">å¤–å– (5% | +3HP)</button>
            <button onclick="doEat(2)">è‡ªç‚Š (10% | +5HP)</button>
            <button onclick="doEat(3)">é¤é¦† (15% | +8HP)</button>
            <button onclick="doNextDay()" class="${nextCls}">${nextTxt}</button>
        </div>
        <p style="font-size:10px; color:red; text-align:center; margin-top:10px;">âš ï¸ èµ„äº§ä½äº10å…ƒå°†å¼ºåˆ¶æ‰£1000å…ƒ</p>
    `);
}

function doEat(type) {
    if (p.mealCount >= 3) { alert("ä»Šå¤©åƒæ’‘äº†ï¼"); return; }
    
    let rate = [0.05, 0.10, 0.15][type-1];
    let hpAdd = [3, 5, 8][type-1];
    let cost = 0;

    // V8.8 æ ¸å¿ƒä¿®å¤ï¼šä½èµ„äº§åˆ¤å®š
    if (p.money < 10) {
        if(!confirm("âš ï¸ æåº¦è´«å›°è­¦å‘Šï¼\nä½ èº«ä¸Šå°‘äº10å—é’±ï¼Œå¼ºè¡Œåƒé¥­å°†è§†ä¸ºã€éœ¸ç‹é¤ã€‘ã€‚\næƒ©ç½šï¼šæ‰£é™¤ Â¥1000 (å˜æˆè´Ÿå€º)ï¼\nè­¦å‘Šï¼šä»Šå¤©å¿…é¡»è¿˜æ¸…ï¼Œå¦åˆ™ä¸‹ä¸€å¤©ç›´æ¥å¤±è´¥ï¼\n\nç¡®å®šè¦åƒå—ï¼Ÿ")) return;
        p.money -= 1000;
        logErr("éœ¸ç‹é¤æƒ©ç½šï¼š-Â¥1000 (è´Ÿå€º)");
    } else {
        cost = Math.floor(p.money * rate);
        if(cost < 1) cost = 1; // æœ€å°‘æ‰£1å—
        p.money -= cost;
        log(`åƒé¥­æ¶ˆè´¹ -Â¥${cost}`);
    }

    p.hp = Math.min(50, p.hp + hpAdd);
    p.mealCount++;
    p.hasEaten = true;
    
    closeModal();
    openRestUI(); // åˆ·æ–°ç•Œé¢
    render(); saveGame();
}

function doNextDay() {
    closeModal();
    nextDay();
}

// === æ¸²æŸ“ç³»ç»Ÿ (å¸¦é”™è¯¯æ•è·) ===
function render() {
    try {
        let city = CONFIG.CITIES[p.city];
        let rank = CONFIG.RANKS[p.rank];

        document.getElementById("uiCompany").innerText = p.name;
        document.getElementById("uiMoney").innerText = "Â¥" + p.money.toLocaleString();
        document.getElementById('uiMoney').style.color = p.money < 0 ? '#ff0000' : '#e3b341';
        document.getElementById("uiHp").innerText = p.hp + "/50";
        document.getElementById("uiHpBar").style.width = (p.hp/50*100) + "%";
        document.getElementById("uiLoc").innerText = city.name;
        document.getElementById("uiRank").innerText = rank.n;
        document.getElementById("uiMeal").innerText = p.mealCount + "/3";
        
        let count = 0;
        for(let k in p.inv) count += p.inv[k];
        document.getElementById("uiCap").innerText = "ğŸ’ " + count + "/" + p.cap;

        // æ¸²æŸ“å¸‚åœº
        let mh = "";
        CONFIG.GOODS.forEach(g => {
            if(p.rank + 1 >= g.r) { // ç­‰çº§è¶³å¤Ÿæ‰æ˜¾ç¤º
                let mk = p.market[g.n] || {p:0,s:0};
                let has = p.inv[g.n] || 0;
                mh += `<div class="list-item">
                    <div><b>${g.n}</b> <small>ä½™${mk.s}</small><br><small style="color:#666">æŒ:${has}</small></div>
                    <div style="color:${varColor(mk.p, g.b)}">Â¥${mk.p}</div>
                    <div>
                        <button class="btn-sm" onclick="trade('${g.n}', -1)">å–</button>
                        <button class="btn-sm" onclick="trade('${g.n}', 'custom')">è‡ª</button>
                        <button class="btn-sm btn-success" onclick="trade('${g.n}', 1)">ä¹°</button>
                    </div>
                </div>`;
            }
        });
        document.getElementById("marketList").innerHTML = mh;

        // æ¸²æŸ“åŸå¸‚
        let ch = "";
        CONFIG.CITIES.forEach((c, i) => {
            if (i !== p.city) {
                let dist = Math.abs(c.dist - city.dist);
                let btn = `<button class="btn-sm" onclick="travel(${i})">å‡ºå‘</button>`;
                ch += `<div class="list-item"><div>${c.n} <small>${dist}km</small></div><div>${btn}</div></div>`;
            }
        });
        document.getElementById("cityList").innerHTML = ch;

    } catch (e) {
        logErr("æ¸²æŸ“å´©æºƒ: " + e.message);
        console.error(e);
    }
}

// === äº¤æ˜“é€»è¾‘ ===
function trade(n, amt) {
    let mk = p.market[n];
    if (amt === 'custom') {
        let input = prompt("è¾“å…¥æ•°é‡ (æ­£æ•°ä¹°/è´Ÿæ•°å–):");
        amt = parseInt(input);
        if (!amt) return;
    }
    
    if (amt > 0) { // ä¹°
        let cost = amt * mk.p;
        if (p.money < cost) return alert("é’±ä¸å¤Ÿ");
        p.money -= cost;
        p.inv[n] = (p.inv[n] || 0) + amt;
    } else { // å–
        let sell = Math.abs(amt);
        if ((p.inv[n] || 0) < sell) return alert("è´§ä¸å¤Ÿ");
        
        // å¤–åœ°é™é¢æ£€æŸ¥
        let val = sell * mk.p;
        if (p.city !== p.home) {
            let limit = CONFIG.RANKS[p.rank].limit;
            if (p.sales + val > limit) return alert(`å¤–åœ°é™é¢å·²æ»¡ (å‰©Â¥${limit-p.sales})`);
            p.sales += val;
        }
        
        p.money += val;
        p.inv[n] -= sell;
    }
    render(); saveGame();
}

function travel(i) {
    let t = CONFIG.CITIES[i];
    let dist = Math.abs(t.dist - CONFIG.CITIES[p.city].dist);
    let cost = dist <= 50 ? 20 : Math.floor(dist * 1.5 + 100);
    
    if (p.money < cost) return alert("è·¯è´¹ä¸è¶³");
    if (!confirm(`å» ${t.n} éœ€è¦ Â¥${cost}ï¼Œç¡®å®šå—ï¼Ÿ`)) return;
    
    // å¦‚æœè¿˜æ²¡åƒé¥­ï¼Œè·³è½¬å»åƒé¥­/ä¸‹ä¸€å¤©
    if (!nextDay()) return; 

    p.money -= cost;
    p.city = i;
    if (i === p.home) { p.sales = 0; log("ğŸ  å›åˆ°åŸºåœ°ï¼Œé¢åº¦é‡ç½®"); }
    
    render(); saveGame();
}

// === åŠŸèƒ½å…¥å£ ===
function openStockUI() {
    if (!p.stock.open) {
        if(confirm("å¼€é€šè‚¡å¸‚éœ€ Â¥1000ï¼Ÿ")) {
            if(p.money < 1000) return alert("é’±ä¸å¤Ÿ");
            p.money -= 1000; p.stock.open = true;
        } else return;
    }
    let h = "";
    p.stock.mkt.forEach(s => {
        let has = p.stock.port[s.n] || 0;
        let col = s.chg >= 0 ? "red" : "green";
        h += `<div class="stock-card">
            <b>${s.n}</b> <span style="float:right;color:${col}">Â¥${s.p}</span><br>
            <small>æŒä»“: ${has}</small>
            <div style="margin-top:5px">
                <button class="btn-sm btn-success" onclick="stockTrade('${s.n}', 100)">ä¹°100</button>
                <button class="btn-sm btn-danger" onclick="stockTrade('${s.n}', -100)">å–100</button>
            </div>
        </div>`;
    });
    showModal("ğŸ“ˆ è‚¡å¸‚", h);
}

function stockTrade(n, amt) {
    let s = p.stock.mkt.find(x => x.n === n);
    if (amt > 0) {
        let cost = amt * s.p;
        if (p.money < cost) return alert("é’±ä¸å¤Ÿ");
        p.money -= cost;
        p.stock.port[n] = (p.stock.port[n] || 0) + amt;
    } else {
        let sell = Math.abs(amt);
        if ((p.stock.port[n] || 0) < sell) return alert("æŒä»“ä¸è¶³");
        p.money += sell * s.p;
        p.stock.port[n] -= sell;
    }
    openStockUI(); render(); saveGame();
}

// === è¾…åŠ©å·¥å…· ===
function showModal(t, c) {
    document.getElementById('mTitle').innerText = t;
    document.getElementById('mContent').innerHTML = c;
    document.getElementById('gameModal').style.display = 'flex';
}
function closeModal() { document.getElementById('gameModal').style.display = 'none'; }
function log(msg) { 
    let b = document.getElementById('gameLog'); 
    b.innerHTML = `<div>> ${msg}</div>` + b.innerHTML; 
}
function logErr(msg) {
    let b = document.getElementById('gameLog'); 
    b.innerHTML = `<div style="color:red;border-bottom:1px dashed red;">âŒ ${msg}</div>` + b.innerHTML; 
}
function varColor(now, base) { return now > base ? '#ff5252' : '#2ea043'; }
function saveGame() { localStorage.setItem("tycoon_v88", JSON.stringify(p)); }
function loadGame() { return localStorage.getItem("tycoon_v88"); }
function hardReset() { localStorage.removeItem("tycoon_v88"); location.reload(); }
function expandCap() {
    let cost = p.cap * 100;
    if(p.money >= cost) { p.money -= cost; p.cap += 10; render(); saveGame(); }
    else alert("æ‰©å®¹éœ€ Â¥" + cost);
}
// å ä½å‡½æ•°é˜²æ­¢æŠ¥é”™
function openBankUI() { alert("é“¶è¡ŒåŠŸèƒ½ç»´æŠ¤ä¸­ï¼ˆé€»è¾‘åŒä¸Šï¼Œä¸ºé˜²è¶…é•¿ä»£ç æˆªæ–­æš‚ç•¥ï¼‰"); }
function openHouseUI() { alert("æˆ¿äº§åŠŸèƒ½ç»´æŠ¤ä¸­"); }
function openLottoUI() { alert("å½©ç¥¨åŠŸèƒ½ç»´æŠ¤ä¸­"); }
function openBlackUI() { alert("é»‘å¸‚åŠŸèƒ½ç»´æŠ¤ä¸­"); }
function share() { alert("æˆ˜ç»©å¤åˆ¶æˆåŠŸ"); }
function exportSave() { prompt("å¤åˆ¶", JSON.stringify(p)); }
function importSave() { try{ p=JSON.parse(prompt("ç²˜è´´")); saveGame(); location.reload(); }catch(e){alert("é”™è¯¯");} }

// åˆå§‹åŒ–
function promote() {
    let next = CONFIG.RANKS[p.rank+1];
    if(p.money >= next.cost) { p.money -= next.cost; p.rank++; render(); saveGame(); }
}
function getInvCount() {
    let c = 0; for(let k in p.inv) c += p.inv[k]; return c;
}
</script>
</body>
</html>

